\section{Engine - Systeme}
\subsection{Math System}

Das Math-System ist für sämtliche mathematischen Berechnungen zuständig. Dazu gehören sehr einfache Rechnungen wie Umwandlung von Grad in Bogenmaß, aber auch komplexere Rechnungen wie zum Beispiel Matrix-Rechnungen. 
Dazu beinhaltet das System mehrere Hilfsklassen, welche in anderen Systemen verwendet werden können. Die Hauptaufgabe ist die Umsetzung der linearen Algebra. 

Um den dreidimensionalen Raum des Spiels darzustellen werden in der FM3D-Engine Vektoren verwendet. Deswegen arbeitet das Math-System hauptsächlich mit Vektoren.
%removed by max
%werden auch die meisten Brechungen mit Vektoren ausgeführt.

Es gibt für Vektoren mit zwei, drei und vier Dimensionen jeweils eine \textit{Template}-Klasse. So kann man in der FM3D-Engine Vektoren mit unterschiedlichen Datentypen für einen Skalar verwenden. 
Diese \textit{Vektor}-Klassen beinhalten Methoden für mathematischen Operatoren, die auf Vektoren anwendbar. Zudem verwendet sie überladene Operatoren, um das zugreifen im Code zu erleichtern. 
Dazu gehören: 
\begin{itemize}
	\item Addition
	\item Subtraktion
	\item Multiplikation
	\item Division
	\item Bildung des Kreuz- und Skalar-Produktes
\end{itemize}

Außerdem ist es möglich die Länge des Vektors zu berechnen und normalisieren.
Es gibt für die grundlegenden Datentypen einen vordefinierten Typ, damit nicht immer ein Vektor mit Template-Parameter ausgeschrieben werden muss. 

Dieser ist folgendermaßen aufgebaut:
$$"`Vector"' + Dimension + Abkürzung des Datentyps$$
Ein dreidimensionaler Vektor mit dem Skalar-Datentyp \textit{float} wäre zum Beispiel: 
$$Vector3f$$

Zu linearer Algebra gehört selbstverständlich auch die Möglichkeit Matrizen zu transformieren.
%Removed by max
%mit Matrizen Transformationen darzustellen. 
Dafür enthält das Math-System die Matrix4f Klasse. Diese repräsentiert eine $4x4$ Matrix mit dem Skalar-Datentyp Float. Sie besitzt die Möglichkeit mit anderen Matrizen, vierdimensionalen und dreidimensionalen Vektoren, multipliziert zu werden. Sie kann auch mit anderen Matrizen addiert, sowie invertiert und transponiert werden. Außerdem enthält die Matrix4f-Klasse einige statische Methoden, um bestimmte Matrizen zu erstellen. Dazu gehören Transformations-, Rotations-, Skalierungs- und Projektionsmatrizen.

\subsection{File System}
Um Dateien verschiedener Formate in der FM3D-Engine verwenden zu können, wird die Klasse \textit{ExternFileManager} verwendet.
Die \textit{ExternFileManager} Klasse besitzt Methoden um Schriftarten, Bilder und Modelle zu laden. Der Methode \textit{ReadFontFile} um die Schriftarten zu laden übergibt man eine Referenz zu dem Namen der Datei. Zudem gibt man die Größe und die Skalierung der Schriftart an. Um die Textur auch in einem RenderSystem dar zu stellen, benötigt die Methode auch eine Referenz zu einem existierenden Objekt der \textit{RenderSystem}-Klasse. Die Methode benötigt zudem eine doppelte Referenz zu einem bereits erstelltes Objekt der Klasse \textit{Font}. 
Die Methode \textit{ReadTextureFile} gibt eine Referenz zu einem Objekt der Klasse Textur zurück. Als Übergabeparameter benötigt diese Methode zunächst das RenderSystem in dem die Textur gerendert werden soll. Außerdem benötigt diese Methode noch  die Enumerationen vom Typen \textit{FilterMode}, \textit{WrapMode} und \textit{MipMapMode}, welche in der Klasse \textit{Textur} stehen. Alle dieser Enumerationen besitzen bereits in dieser Methode einen Standardwert und müssen nicht explizit angegeben. Zur Erläuterung dieser Enumerationen siehe den \cref{Textureclass}. 
Die Methode \textbf{ReadModelFile} benötigt als Übergabeparameter den Dateinamen, das RenderSystem in dem das Model geladen werden soll. Ein boolescher Übergabeparameter gibt an, ob \textit{Instancing} verwendet werden soll. Der darauffolgende  boolescher Wert gibt an, ob eine Animation in dem Model verwendet werden soll. Eine vierstellige Matrix \textit{Matrix4f} gibt \todo[inline]{!!!} an.
Zur Initialisierung wird die Methode \textit{Initialize} verwendet.

\subsection{Graphic System}

\subsubsection{Fenster}
Jedes GUI benötigt ein \textit{Fenster}, in dem die Grafiken angezeigt werden können. Dafür existiert die Klasse \textit{Win32Window}, die von der Klasse Windows erbt, welche die Grundstruktur und Grundinformationen für ein Fenster besitzt. 
Um ein Fenster zu starten verwendet man die Methode \textit{Start}, welcher man die Größe Breite und Höhe des Fensters, den Fenstertitel übergibt. Das Fenster kann mit der Methode \textit{Close} geschlossen werden.
Aus der Klasse Windows werden \textit{Get-} und \textit{Set-}Methoden für die Größe und Position des Fensters auf dem Bildschirm und private Attribute die diese Werte angeben geerbt.
Zudem besitzt die Klasse \textit{Window} statische Methoden um ein Fenster zu erstellen, die Position eines Fensters zu bestimmen, eine Konsole zu starten und die Position dieser zu bestimmen.

\subsubsection{RenderSystem}
Um in diesem Fenster nun zu rendern benötigt man ein Objekt der Klasse RenderSystem. Das RenderSystem kontrolliert das Rendering der FM3D-Engine in der Anwendung. Diese Klasse besitzt eine Initialisierungsmethode, welcher man die Werte 

\subsubsection{Font-Klasse}
\label{Fontclass}
Objekte der Font-Klasse repräsentieren Schriftarten, welche man im Programm rendern kann.
\todo[inline]{!!!}
\subsubsection{Texture-Klasse}
\label{Textureclass}
Die Klasse besitzt die Enumerationen \textit{FilterMode}, \textit{WrapMode} und \textit{MipMapMode}
\todo[inline]{!!!}
\subsubsection{Model-Klasse}
\label{Modelclass}
\todo[inline]{!!!}
\subsubsection{Material-Klasse}
\todo[inline]{!!!}

\input{03unserprogramm/Engine/entitysystem}

\subsection{Tasten-Eingabe System}
Natürlich benötigt ein Spiel auch ein sicheres Eingabe-System, welches sowohl die Position der Maus ermittelt, aber auch die Abfrage jeder einzelnen Taste auf der Tastatur regelt. 
Dafür wurde in der FM3D-Engine eine eigene Klasse implementiert, welche sich um dies kümmert.
Um den Nutzer der FM3D-Engine davor zu bewahren nicht jeden einzelnen ASCII-Code jeder Taste auf der Tastatur nachzuschlagen, sind alle Tasten in Form von Makros definiert. 
In dem Namespace FM3D befindet sich die Klasse Inputsystem. Diese Klasse besitzt eine rekursive Instanz, mit welcher man das Inputsystem ansprechen kann. 
Die Klasse beinhaltet außerdem die Enumeration \textit{KEYCLICK}, welches den aktuellen Stand der Maustasten beschreibt. Diese können entweder gedrückt, nicht gedrückt oder losgelassen werden und sind in dieser Enumeration definiert.
Eine Struktur \textit{MOUSE} enthält die Enumeration \textit{KEYCLICK} und einen zweidimensionalen Vektor des Typen \textit{Float}, welcher die zweidimensionale Position im Fenster angibt, an welcher eine Taste der Maus gedrückt wurde.
Diese Struktur wird im Inputsystem als ein vier-Felder Array verwendet, welches jede Taste einer durchschnittlichen Maus beschreibt. Diese sind die linke, die rechte und die mittlere Maustaste. 
Zudem besitzt das \textit{Inputsystem} einen Vektor \textit{lastposinst}, welcher ununterbrochen die Position der Maus ermittelt. Dies ist in den Spielen erforderlich in denen die Maus ununterbrochen die Kamera steuert.

Für die Tastenabfrage wurde zunächst ein Integer Wert verwendet, in welchen der aktuell gedrückte ASCII-Code gespeichert wurde. Dies hat aber den Nachteil, dass nur eine Taste gedrückt sein bzw. abgefragt werden kann. Möchte man nun zum Beispiel einen Spiele-Charakter schräg durch einen Raum durch gedrückte Links- \textbf{und} Rechts-Taste bewegen, so wäre das mit dieser Möglichkeit nicht möglich. Deswegen beschreibt nun ein 121-Felder Array aus booleschen Werten die komplette Tastatur. Jede Feldnummer ist äquivalent zu dem zugeordneten ASCII-Code der Taste. Die Felder [1] bis [4] beschreiben die Maustasten. Einige Felder des Arrays sind nicht von einem ASCII Code auf der Tastatur \textit{belegt} und sind somit "`\textit{frei}"'. Dies hat den Vorteil, dass später simpel weitere Eingabegeräte in das Inputsystem eingebunden werden können.

Die Klasse besitzt Methoden, welche in der Klasse Win32Window.h (Siehe Doxygen Dokumentation), die ein GUI-Fenster abbildet, um die verschiedenen Werte der Arrays und des Vektors zu setzen.
Zudem besitzt die Klasse Methoden, die diese Werte zurück geben. (Für die Verwendung dieser Klasse siehe \cref{inputsystemver})